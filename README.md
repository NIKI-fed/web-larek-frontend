# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных

Интерфейс для описания карточки товара
```
interface IGoods {
    id: string;
    description?: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
    buttonText?: string;
    index?: string;
}
```

Интерфейс для описания корзины с товарами
```
interface IBasket {
    items: string[]; // товары в корзине по id
    total: number; // стоимость товаров в корзине
}
```

Интерфейс для описания контактных данных покупателя, а также способа оплаты
```
interface IContactData {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```

Интерфейс для описания заказа
```
interface IOrder {
    payment: PaymentMethod;
    address: string;
    email: string;
    phone: string;
    goods?: string[];
    total_cost?: number;
}
```

Интерфейс для описания успешного оформления заказа
```
interface ISuccess {
    total: number; // списанная сумма
}
```

Тип оплаты
```
type PaymentMethod = 'card' | 'cash' | null
```

Опишем классы, которыми будем реализовать указанные интерфейсы.

## Базовые классы

### Базовый класс API

Базовый класс Api предоставляет абстрактный слой для выполнения HTTP-запросов, инкапсулируя базовые операции вроде GET и POST/PUT/DELETE, а также обеспечивая унифицированную обработку ответов. 

### Базовый класс Component

Является абстрактным классом. Служит основой для создания компонентов пользовательского интерфейса, предоставляя методы для управления элементами DOM и их состояниями.

### Базовый класс EventEmitter

Класс EventEmitter реализует паттерн «Наблюдатель», позволяя объектам подписываться на события, инициировать их и управлять подпиской.

## Модели данных

### Класс AppData

Является моделью данных приложения и отвечает за хранение данных, включая товары в каталоге, корзину покупок, заказ и контактные данные. Он предоставляет методы для обновления каталога, добавления и удаления товаров из корзины, выбора способа оплаты, а также валидации форм оплаты и контактных данных.

Содержит следующие методы и свойства:
```
Свойства

catalog: IGoods[] // массив со всеми товарами
    preview: IGoods | null // конкретный товар для открытия в модальном окне
    basket: IBasket = {
        items: [], // id товаров, которые в корзине
        total: 0, // стоимость товаров в корзине
    };
    order: IOrder = {
        payment: null, // метод оплаты по умолчанию
        address: '',
        email: '',
        phone: ''
    };
    formErrors: Partial<Record<keyof IOrder, string>> = {}; // св-во для хранения ошибок формы, связанных с IOrder

Методы

// Работа с каталогом и товарами
// Обновление каталога
    updateCatalog(catalog: IGoods[])

// Устанавливаем текущий товар для предпросмотра
    goodsPreview(item: IGoods)

// Работа с корзиной
// Проверяем, находится ли товар в корзине
    goodsInBasket(item: IGoods): boolean

// Добавляем товар в корзину
    addGoodsInBasket(item: IGoods)

// Удаляем товар из корзины
    removeGoodsFromBasket(item: IGoods)

// Выбор способа оплаты
    setPaymentMethod(method: PaymentMethod)

// Валидация формы оплата/адрес
    validatePaymentAddressForm(): boolean 

// Установка значения для формы оплата/адрес
    setPaymentAddress(field: keyof IContactData, value: string)

// Валидация формы контактов
    validateContact(): boolean

// Установка значения для формы контактов
    setContact(field: keyof IContactData, value: string)

// Проверка на наличие бесценного товара в корзине
    checkPriceless(goods: string)

// Очистка данных заказа
    clearOrder()

// Очистка корзины
    clearBasket()
```

## Компоненты представления
### Класс Card

Класс Card является компонентом пользовательского интерфейса, представляющим карточку товара.
Класс реализует интерфейс IGoods и является дочерним для базового класса Component.
Он предоставляет методы для управления содержимым карточки, такими как название, категория, цена, изображение и кнопка действий. Класс может использоваться для отображения информации о товаре в каталоге или корзине покупок.

**Конструктор**

Конструктор класса Card принимает два параметра:

- container: элемент DOM, который будет использоваться в качестве контейнера для карточки товара.
- actions?: объект типа ICardActions, содержащий коллбек функции для обработки кликов на карточке.

В конструкторе происходит инициализация внутренних свойств компонента, таких как заголовок (_title), цена (_price) и другие элементы карточки. Также, если передан объект действий (actions), то устанавливается обработчик события клика на кнопке или самом контейнере карточки.

**Свойства**

- id: строковый идентификатор товара. Геттер возвращает значение атрибута data-id контейнера, сеттер устанавливает значение этого атрибута.
  
- title: название товара. Геттер возвращает текстовое содержимое элемента _title, сеттер устанавливает этот текст.

- index: индекс товара. Устанавливает текстовое содержимое элемента _index.

- category: категория товара. Геттер возвращает текстовое содержимое элемента _category. Сеттер устанавливает текстовое содержимое элемента _category и применяет соответствующий класс стиля в зависимости от значения категории.

- image: URL изображения товара. Сеттер устанавливает источник изображения для элемента _image и альтернативный текст, используя свойство title.

- description: описание товара. Сеттер устанавливает текстовое содержимое элемента _description.

- price: цена товара. Геттер возвращает числовое значение цены товара. Сеттер устанавливает цену товара в виде строки, добавляя единицы измерения ("синапс"). Если цена равна null, то отображается текст "Бесценно" и блокируется кнопка добавления в корзину.

**Методы**

- setButtonText(value: boolean): метод устанавливает текст на кнопке в зависимости от переданного булевого значения. Если true, то текст будет "Удалить из корзины", иначе – "Добавить в корзину".

### Класс Page

Класс реализует интерфейс IPage
```
    counter: number; // количество товаров в корзине
    catalog: HTMLElement[]; // массив товаров
    locked: boolean; // блокировка прокрутки страницы
```
и является дочерним для базового класса Component.
Класс Page управляет состоянием страницы, обновляет счетчик товаров в корзине, изменяет содержимое каталога и блокирует прокрутку страницы.

**Конструктор**

Конструктор класса Page принимает два параметра:

- container: элемент DOM, который будет использоваться в качестве контейнера для страницы.
- events: объект типа IEvents, используемый для управления событиями на странице.

В конструкторе происходит инициализация внутренних свойств компонента, таких как счетчик товаров в корзине (_counter), каталог товаров (_catalog), обертка страницы (_wrapper) и кнопка корзины (_basket). Также добавляется обработчик события клика на кнопку корзины, который вызывает событие открытия корзины через объект событий (events).

**Свойства**

- counter: количество товаров в корзине. Сеттер устанавливает текстовое содержимое элемента _counter.

- catalog: массив элементов DOM, представляющих товары в каталоге. Сеттер заменяет все дочерние элементы каталога новыми товарами.

- locked: состояние блокировки страницы. Сеттер добавляет или удаляет класс page__wrapper_locked у обертки страницы в зависимости от значения.

**Методы**

Дополнительных методов нет, кроме тех, что предоставляются базовым классом Component.

### Класс Modal

Класс Modal представляет компонент модального окна, которое может содержать произвольное содержимое. Он предоставляет методы для открытия и закрытия окна, а также обрабатывает события кликов для корректного поведения модалки. Компонент интегрирован с системой событий для уведомлений о состоянии окна.
Класс является дочерним для базового класса Component.

**Конструктор**

Конструктор класса Modal принимает два параметра:

- container: элемент DOM, который будет использоваться в качестве контейнера для модального окна.
- events: объект типа IEvents, используемый для управления событиями в модальном окне.

В конструкторе происходит инициализация внутренних свойств компонента, таких как кнопка закрытия (_closeButton) и область содержимого (_content). Также устанавливаются обработчики событий для закрытия модального окна при нажатии на кнопку закрытия или сам контейнер, а также предотвращается закрытие окна при клике внутри области содержимого.

**Свойства**

- content: содержимое модального окна. Сеттер заменяет содержимое области содержимого новым элементом.

**Методы**

- open(): открывает модальное окно, добавляя класс modal_active к контейнеру и вызывая событие 'modal:open'.
- close(): закрывает модальное окно, удаляя класс modal_active из контейнера, очищая содержимое и вызывая событие 'modal:close'.
- render(data: IModalData): HTMLElement: рендерит модальное окно, устанавливая его содержимое и открывая его. Возвращает контейнер модального окна.

### Класс Basket

Класс реализует интерфейс IBasketView
```
    items: HTMLElement[]; // список товаров в корзине
    total: number; // общая стоимость
    selected: string[]; //список id товаров
```
и является дочерним для базового класса Component.
Класс Basket представляет компонент корзины покупок, управляющий списком товаров, их общей стоимостью и кнопкой оформления заказа. Он обновляет интерфейс корзины в зависимости от добавленных товаров и отправляет событие при нажатии на кнопку оформления заказа.

**Конструктор**

Конструктор класса Basket принимает два параметра:

- container: элемент DOM, который будет использоваться в качестве контейнера для корзины.
- events: объект типа EventEmitter, используемый для управления событиями в корзине.

В конструкторе происходит инициализация внутренних свойств компонента, таких как список товаров (_list), общая стоимость (_total) и кнопка оформления заказа (_button). Также устанавливается обработчик события клика на кнопку оформления заказа, который вызывает событие 'order:open'.

**Свойства**

- items: список элементов DOM, представляющий товары в корзине. Сеттер обновляет содержимое списка товаров. Если список не пустой, то кнопка оформления заказа становится активной, иначе выводится сообщение о том, что корзина пуста, и кнопка становится неактивной.
- total: общая стоимость товаров в корзине. Сеттер устанавливает текстовое содержимое элемента _total.

**Методы**

- toggleButton(state: boolean): метод переключения состояния кнопки "Оформить". Если state равно true, то кнопка становится активной, иначе — неактивной.

### Класс Form

Класс Form представляет собой компонент формы, который управляет её состоянием, проверяет валидность введённых данных и реагирует на изменения полей ввода. Он также отправляет события при изменении значений полей и при попытке отправки формы.

**Конструктор**

Конструктор класса Form принимает два параметра:

- container: элемент DOM типа HTMLFormElement, который будет использоваться в качестве контейнера для формы.
- events: объект типа IEvents, используемый для управления событиями в форме.

В конструкторе происходит инициализация внутренних свойств компонента, таких как кнопка отправки (_submit) и элемент для отображения ошибок (_errors). Также устанавливаются обработчики событий для отслеживания изменений в полях формы и отправки формы.

**Свойства**

- valid: логическое значение, определяющее, является ли форма валидной. Сеттер изменяет доступность кнопки отправки в зависимости от валидности формы.
- errors: строка, содержащая ошибки формы. Сеттер устанавливает текстовое содержимое элемента _errors.

**Методы**

- onInputChange(field: keyof T, value: string): метод, вызываемый при изменении значений полей формы. Он инициирует событие изменения конкретного поля с передачей имени поля и нового значения.
- render(state: Partial<T> & IFormState): HTMLFormElement: метод рендера формы. Он разбивает переданное состояние на части, соответствующие валидности, ошибкам и полям формы, и затем обновляет эти части.

### Класс PaymentAddress

Класс PaymentAddress представляет форму для ввода данных об оплате и адресе доставки. Он наследует функционал базового класса Form и добавляет элементы управления для выбора способа оплаты (карта или наличные) и ввода адреса. При выборе способа оплаты класс отправляет соответствующее событие, а также меняет внешний вид кнопок за счёт переключения css-класса.

**Конструктор**

Конструктор класса PaymentAddress принимает два параметра:

- container: элемент DOM типа HTMLFormElement, который будет использоваться в качестве контейнера для формы.
- events: объект типа IEvents, используемый для управления событиями в форме.

В конструкторе происходит инициализация внутренних свойств компонента, таких как кнопки выбора способа оплаты (_buttonPaymentCard, _buttonPaymentCash) и поле ввода адреса (_address). Также устанавливаются обработчики событий для отслеживания кликов на кнопках выбора способа оплаты.

**Свойства**

- payment: способ оплаты. Сеттер переключает активный класс между кнопками оплаты в зависимости от выбранного метода.
- address: адрес доставки. Сеттер устанавливает значение поля ввода адреса.

**Методы**

Дополнительных методов нет, кроме тех, что предоставляются базовым классом Form:

### Класс ContactsForm

Класс ContactsForm наследует функционал базового класса Form и представляет форму для ввода контактных данных, таких как электронная почта и номер телефона. Он предоставляет сеттеры для установки значений полей ввода.

**Конструктор**

Конструктор класса ContactsForm принимает два параметра:

- container: элемент DOM типа HTMLFormElement, который будет использоваться в качестве контейнера для формы.
- events: объект типа IEvents, используемый для управления событиями в форме.

В конструкторе происходит инициализация внутренних свойств компонента, таких как поля ввода для электронной почты (_email) и номера телефона (_phone).

**Свойства**

- email: электронная почта. Сеттер устанавливает значение поля ввода электронной почты.
- phone: номер телефона. Сеттер устанавливает значение поля ввода номера телефона.

**Методы**

Дополнительных методов нет, кроме тех, что предоставляются базовым классом Form:

### Класс Success

Класс Success представляет компонент окна, которое отображается после успешного оформления заказа. Наследуется от базового класса Componentю. Класс включает в себя кнопку закрытия окна и элемент для отображения списанной суммы. Компонент позволяет установить обработчик для кнопки закрытия и обновить информацию о списанных средствах.

**Конструктор**

Конструктор класса Success принимает два параметра:

- container: элемент DOM, который будет использоваться в качестве контейнера для окна успеха.
- actions: объект типа ISuccessActions, содержащий функцию обратного вызова для обработки клика на кнопку закрытия.

В конструкторе происходит инициализация внутренних свойств компонента, таких как кнопка закрытия (_close) и элемент для отображения списанной суммы (_total). Также устанавливается обработчик события клика на кнопку закрытия, если передан соответствующий колбэк.

**Свойства**

- total: списанная сумма. Сеттер устанавливает текстовое содержимое элемента _total.

### Методы

Дополнительных методов нет, кроме тех, что предоставляются базовым классом Component.

## Взаимодействие компонентов

Взаимодействие между собой и инициализация всех компонентов осуществляется через файл index.ts, который выполняет роль презентера.

Основные функции модуля:

1. Импорт зависимостей: Импортируются стили, константы, классы и утилиты, необходимые для работы приложения.

2. Создание экземпляров классов: Создаются объекты для работы с событиями (EventEmitter), данными (AppData) и сетевыми запросами (LarekAPI).

3. Загрузка данных: При запуске приложения выполняется запрос к API для получения списка товаров, которые затем отображаются на странице.

4. Подписка на события: Определяются обработчики для различных событий, таких как изменение элементов каталога, выбор товара для просмотра в модальном окне, открытие и закрытие модальных окон, изменение состава корзины и другие.

5. Отображение данных: В зависимости от происходящих событий, обновляются соответствующие части интерфейса, такие как карточка товара, состав корзины, состояние модального окна и прочее.

6. Обработка взаимодействий: Реализованы обработчики для взаимодействия с пользователем, такие как добавление и удаление товаров из корзины, переход к просмотру деталей товара, оформление заказа и завершение покупки.


### Описание событий

1. События каталога:
    - items:change - происходит при изменении элементов каталога
    - card:select - выбор товара для предварительного просмотра

2. События модального окна:
    - modal:open - открытие модального окна, включает блокировку прокрутки страницы
    - modal:close - закрытие модального окна, снимает блокировку прокрутки страницы

3. События корзины:
    - basket:open - открывает корзину, модальное окно заполняется содержимым корзины
    - basket:change - изменение содержимого корзины. Обновляется счетчик товаров в корзине и содержимое самой корзины.

4. События заказа: 
    - order:open - открывается форма для ввода данных оплаты и адреса доставки
    - order.<поле>:change - меняются значения полей в форме оплаты/адреса, это событие обрабатывается для каждого поля формы отдельно
    - orderFormErrors:change - формируются и выводятся ошибки валидации для формы оплаты/адреса
    - order:submit - форма оплаты/адреса подтверждена, открывается форма для ввода контактных данных

    - contacts.<поле>:change - меняются значения полей в форме контактов, это событие обрабатывается для каждого поля формы отдельно
    - contactFormErrors:change - формируются и выводятся ошибки валидации для формы контактов
    - contact:ready - указывает, что форма контактов заполнена корректно
    - contacts:submit - форма контактов подтверждена, открывается окно с подтверждением успешной покупки

После подтверждения форм заказ проверяется с помощью метода checkPriceless, если условия выполнены, заказ отправляется на сервер вызовом метода api.postOrder.

    - success:open - открывается окно с информацией об успешном завершении покупки
    - clearBasket - очищается корзина
    - clearOrder - очищаются данные заказа





