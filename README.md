# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных

Интерфейс для описания карточки товара
```
interface IGoods {
    id: string;
    description?: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
    buttonText?: string;
    index?: string;
}
```

Интерфейс для описания корзины с товарами
```
interface IBasket {
    items: string[]; // товары в корзине по id
    total: number; // стоимость товаров в корзине
}
```

Интерфейс для описания способа оплаты
```
interface IPaymentMethod {
    payment: string;
}
```

Интерфейс для описания контактных данных покупателя, а также способа оплаты
```
interface IContactData {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```

Интерфейс для описания заказа
```
interface IOrder {
    payment: PaymentMethod;
    address: string;
    email: string;
    phone: string;
    goods?: string[];
    total_cost?: number;
}
```

Интерфейс для описания успешного оформления заказа
```
interface ISuccess {
    total: number; // списанная сумма
}
```

Тип оплаты
```
type PaymentMethod = 'card' | 'cash' | null
```

Опишем классы, которыми будем реализовать указанные интерфейсы.

## Базовые классы

### Базовый класс API

Базовый класс Api предоставляет абстрактный слой для выполнения HTTP-запросов, инкапсулируя базовые операции вроде GET и POST/PUT/DELETE, а также обеспечивая унифицированную обработку ответов. 

### Базовый класс Component

Служит основой для создания компонентов пользовательского интерфейса, предоставляя методы для управления элементами DOM и их состояниями.

### Базовый класс EventEmitter

Класс EventEmitter реализует паттерн «Наблюдатель», позволяя объектам подписываться на события, инициировать их и управлять подпиской.

## Модели данных

### Класс AppData

Является моделью данных приложения и отвечает за хранение данных, включая товары в каталоге, корзину покупок, заказ и контактные данные. Он предоставляет методы для обновления каталога, добавления и удаления товаров из корзины, выбора способа оплаты, а также валидации форм оплаты и контактных данных.

Содержит следующие методы и свойства:
```
Свойства

catalog: IGoods[] // массив со всеми товарами
    preview: IGoods | null // конкретный товар для открытия в модальном окне
    basket: IBasket = {
        items: [], // id товаров, которые в корзине
        total: 0, // стоимость товаров в корзине
    };
    order: IOrder = {
        payment: null, // метод оплаты по умолчанию
        address: '',
        email: '',
        phone: ''
    };

Методы

// Работа с каталогом и товарами
// Обновление каталога
    updateCatalog(catalog: IGoods[])

// Устанавливаем текущий товар для предпросмотра
    goodsPreview(item: IGoods)

// Работа с корзиной
// Проверяем, находится ли товар в корзине
    goodsInBasket(item: IGoods): boolean

// Добавляем товар в корзину
    addGoodsInBasket(item: IGoods)

// Удаляем товар из корзины
    removeGoodsFromBasket(item: IGoods)

// Выбор способа оплаты
    setPaymentMethod(method: PaymentMethod)

// Валидация формы оплата/адрес
    validatePaymentAddressForm(): boolean 

// Установка значения для формы оплата/адрес
    setPaymentAddress(field: keyof IContactData, value: string)

// Валидация формы контактов
    validateContact(): boolean

// Установка значения для формы контактов
    setContact(field: keyof IContactData, value: string)

// Проверка на наличие бесценного товара в корзине
    checkPriceless(goods: string)

// Очистка данных заказа
    clearOrder()

// Очистка корзины
    clearBasket()
```

## Компоненты представления
### Класс Card

Класс Card является компонентом пользовательского интерфейса, представляющим карточку товара.
Класс реализует интерфейс IGoods и является дочерним для базового класса Component.
Он предоставляет методы для управления содержимым карточки, такими как название, категория, цена, изображение и кнопка действий. Класс может использоваться для отображения информации о товаре в каталоге или корзине покупок.

### Класс Page

Класс реализует интерфейс IPage
```
    counter: number; // количество товаров в корзине
    catalog: HTMLElement[]; // массив товаров
    locked: boolean; // блокировка прокрутки страницы
```
и является дочерним для базового класса Component.
Класс Page управляет состоянием страницы, обновляет счетчик товаров в корзине, изменяет содержимое каталога и блокирует прокрутку страницы.

### Класс Modal

Класс Modal представляет компонент модального окна, которое может содержать произвольное содержимое. Он предоставляет методы для открытия и закрытия окна, а также обрабатывает события кликов для корректного поведения модалки. Компонент интегрирован с системой событий для уведомлений о состоянии окна.
Класс является дочерним для базового класса Component.

### Класс Basket

Класс реализует интерфейс IBasketView
```
    items: HTMLElement[]; // список товаров в корзине
    total: number; // общая стоимость
    selected: string[]; //список id товаров
```
и является дочерним для базового класса Component.
Класс Basket представляет компонент корзины покупок, управляющий списком товаров, их общей стоимостью и кнопкой оформления заказа. Он обновляет интерфейс корзины в зависимости от добавленных товаров и отправляет событие при нажатии на кнопку оформления заказа.

### Класс Form

Класс Form представляет собой компонент формы, который управляет её состоянием, проверяет валидность введённых данных и реагирует на изменения полей ввода. Он также отправляет события при изменении значений полей и при попытке отправки формы.

### Класс PaymentAddress

Класс PaymentAddress представляет форму для ввода данных об оплате и адресе доставки. Он наследует функционал базового класса Form и добавляет элементы управления для выбора способа оплаты (карта или наличные) и ввода адреса. При выборе способа оплаты класс отправляет соответствующее событие, а также меняет внешний вид кнопок за счёт переключения css-класса.

### Класс ContactsForm

Класс ContactsForm наследует функционал базового класса Form и представляет форму для ввода контактных данных, таких как электронная почта и номер телефона. Он предоставляет сеттеры для установки значений полей ввода.

### Класс Success

Класс Success представляет компонент окна, которое отображается после успешного оформления заказа. Он включает в себя кнопку закрытия окна и элемент для отображения списанной суммы. Компонент позволяет установить обработчик для кнопки закрытия и обновить информацию о списанных средствах.

## Взаимодействие компонентов

Взаимодействие между собой и инициализация всех компонентов осуществляется через файл index.ts, который выполняет роль презентера.

Основные функции модуля:

1. Импорт зависимостей: Импортируются стили, константы, классы и утилиты, необходимые для работы приложения.

2. Создание экземпляров классов: Создаются объекты для работы с событиями (EventEmitter), данными (AppData) и сетевыми запросами (LarekAPI).

3. Загрузка данных: При запуске приложения выполняется запрос к API для получения списка товаров, которые затем отображаются на странице.

4. Подписка на события: Определяются обработчики для различных событий, таких как изменение элементов каталога, выбор товара для просмотра в модальном окне, открытие и закрытие модальных окон, изменение состава корзины и другие.

5. Отображение данных: В зависимости от происходящих событий, обновляются соответствующие части интерфейса, такие как карточка товара, состав корзины, состояние модального окна и прочее.

6. Обработка взаимодействий: Реализованы обработчики для взаимодействия с пользователем, такие как добавление и удаление товаров из корзины, переход к просмотру деталей товара, оформление заказа и завершение покупки.


### Описание событий

1. События каталога:
    - items:change - происходит при изменении элементов каталога
    - card:select - выбор товара для предварительного просмотра

2. События модального окна:
    - modal:open - открытие модального окна, включает блокировку прокрутки страницы
    - modal:close - закрытие модального окна, снимает блокировку прокрутки страницы

3. События корзины:
    - basket:open - открывает корзину, модальное окно заполняется содержимым корзины
    - basket:change - изменение содержимого корзины. Обновляется счетчик товаров в корзине и содержимое самой корзины.

4. События заказа: 
    - order:open - открывается форма для ввода данных оплаты и адреса доставки
    - order.<поле>:change - меняются значения полей в форме оплаты/адреса, это событие обрабатывается для каждого поля формы отдельно
    - orderFormErrors:change - формируются и выводятся ошибки валидации для формы оплаты/адреса
    - order:submit - форма оплаты/адреса подтверждена, открывается форма для ввода контактных данных

    - contacts.<поле>:change - меняются значения полей в форме контактов, это событие обрабатывается для каждого поля формы отдельно
    - contactFormErrors:change - формируются и выводятся ошибки валидации для формы контактов
    - contact:ready - указывает, что форма контактов заполнена корректно
    - contacts:submit - форма контактов подтверждена, открывается окно с подтверждением успешной покупки

После подтверждения форм заказ проверяется с помощью метода checkPriceless, если условия выполнены, заказ отправляется на сервер вызовом метода api.postOrder.

    - success:open - открывается окно с информацией об успешном завершении покупки
    - clearBasket - очищается корзина
    - clearOrder - очищаются данные заказа





